@model ShopVM

﻿
<div class="container">
    <div class="row">
        <div class="col-lg-4">
            <div class="sidebar-area">
                <div class="widgets-searchbox">
                    <form id="widgets-searchbox" action="">
                        <input type="text" class="input-field" placeholder="Search">
                        <button class="widgets-searchbox-btn" type="submit">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </button>
                    </form>
                </div>
                <div class="widgets-area">
                    <div class="widgets-item">
                        <h2 class="widgets-title" style="cursor:pointer;">Categories</h2>
                        <ul class="widgets-category mt-4">
                            @foreach(Category category in Model.Categories)
                            {
                                <li>
                                    <a class="catogoryfilter" style="cursor:pointer;" data-categoryId="@category.Id" data-pageIndexId="@ViewBag.PageIndex" data-priceRange="@ViewBag.Range">
                                        <i class="fa-solid fa-chevron-right"></i>
                                        @category.Name
                                        <span>(@category.Products.Count())</span>
                                    </a>
                                </li>
                            }

                            
                            
                        </ul>
                    </div>

                    <div class="widgets-item">
                        <h2 class="widgets-title" style="cursor:pointer;">Color</h2>
                        <ul class="widgets-color">
                            <li>
                                <a href=""><i class="fa-solid fa-chevron-right"></i> All<span>(65)</span></a>
                            </li>
                            <li>
                                <a href=""><i class="fa-solid fa-chevron-right"></i> Gold<span>(12)</span></a>
                            </li>
                            <li>
                                <a href=""><i class="fa-solid fa-chevron-right"></i>Green <span>(22)</span></a>
                            </li>
                            <li>
                                <a href=""><i class="fa-solid fa-chevron-right"></i>White<span>(13)</span></a>
                            </li>
                            <li>
                                <a href=""><i class="fa-solid fa-chevron-right"></i>Black<span>(10)</span> </a>
                            </li>
                        </ul>
                    </div>
                    <div class="widgets-item widgets-filter">
                        <h2 class="widgets-title" style="cursor:pointer;">Price Filter</h2>
                        <div class="wrapper">
                            <fieldset class="filter-price">

                                <div class="price-field">
                                    <input class="rangeInput" type="range" min="5" max="100" value="5" id="lower">
                                    <input class="rangeInput" type="range" min="5" max="100" value="100" id="upper">
                                </div>
                                <div class="price-wrap">
                                    <div class="price-wrap-1">
                                        <input id="one">
                                        <label for="one">$</label>
                                    </div>
                                    <div class="price-wrap_line">-</div>
                                    <div class="price-wrap-2">
                                        <input id="two">
                                        <label for="two">$</label>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <div class="widgets-item">
                        <h2 class="widgets-title" style="cursor:pointer;">Size</h2>
                        <ul class="widgets-size">
                            <li>
                                <a href="#">
                                    <i class="fa-solid fa-chevron-right"></i>
                                    All
                                    <span>(05)</span>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <i class="fa-solid fa-chevron-right"></i>
                                    Medium
                                    <span>(05)</span>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <i class="fa-solid fa-chevron-right"></i>
                                    Large
                                    <span>(13)</span>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <i class="fa-solid fa-chevron-right"></i>
                                    Small
                                    <span>(25)</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <button data-categoryId="@ViewBag.CategoryId" data-pageIndexId="@ViewBag.PageIndex" class="shop-btn rangeFilter">Filter</button>
                </div>
            </div>
        </div>
        <div class="col-lg-8">
            <div class="product-topbar">
                <ul class="d-flex justify-content-center align-items-center">
                    <li class="page-count">
                        <span>12</span>
                        Product Found of
                        <span>30</span>
                    </li>
                    <li class="sort">
                        <select class="nice-select" name="sortby">
                            <option value="trending">Sort by Default</option>
                            <option value="trending">Sort by Popularity</option>
                            <option value="trending">Sort by Rated</option>
                            <option value="trending">Sort by Latest</option>
                            <option value="trending">Sort by High Price</option>
                            <option value="trending">Sort by Low Price</option>
                        </select>
                    </li>
                </ul>
            </div>
            <div class="all-products">
                <div class="row shopList">
                   
                        @foreach(Product product in Model.Products)
                        {
                        <div class="col-lg-4">
                           <div class="product-item">
                            <div class="product-img">
                                <a asp-controller="product" asp-action="detail" asp-route-id="@product.Id">
                                    <img class="primary-img" src="~/assets/img/product/@product.MainImage" alt="" />
                                    <img class="secondary-img" src="~/assets/img/product/@product.HoverImage" alt="" />
                                </a>
                                <div class="product-add-action">
                                    <ul class="product-action">
                                        <li>
                                            <a class="addToWishList" asp-controller="wishlist" asp-action="AddWishList" asp-route-id="@product.Id">
                                                <i class="fa-regular fa-heart"></i>
                                            </a>
                                        </li>
                                        <li>
                                            <a class="productModal" asp-action="ProductModal" asp-controller="Product" asp-route-id="@product.Id">
                                                <i class="fa-regular fa-eye"></i>
                                            </a>
                                        </li>
                                        <li>
                                            <a class="addToBasket" data-id="@product.Id">
                                                <i class="fa-solid fa-cart-shopping"></i>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="product-content">
                                <a class="product-name" href="single-product.html">@product.Title</a>
                                <div class="price-box">
                                    <span class="new-price">$@product.Price</span>
                                </div>
                                <div class="rating-box">
                                    <ul class="rating">
                                        <li>
                                            <i class="fa-solid fa-star"></i>
                                        </li>
                                        <li>
                                            <i class="fa-solid fa-star"></i>
                                        </li>
                                        <li>
                                            <i class="fa-solid fa-star"></i>
                                        </li>
                                        <li>
                                            <i class="fa-solid fa-star"></i>
                                        </li>
                                        <li>
                                            <i class="fa-solid fa-star"></i>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        </div>
                        }
                        
                    


                </div>
            </div>
            <div class="pagination-area">
                <nav>
                    <ul class="pagination">
                        
                            @if (ViewBag.PageIndex > 1)
                            {
                                <li class="page-item">
                                <a class="page-link" data-categoryId="@ViewBag.CategoryId" data-pageIndexId="@(ViewBag.PageIndex-1)" data-priceRange="@ViewBag.Range">
                                        <i class="fa-solid fa-angles-left"></i>
                                    </a>
                                </li>
                            }
                            @for (var i = 1; i <= ViewBag.PageCount; i++)
                            {
                            if (i >= ViewBag.PageIndex - 2 && i <= ViewBag.PageIndex + 2)
                            {
                                <li class="page-item @(i==ViewBag.PageIndex ? "active" : "")">
                                    <a class="page-link" data-categoryId="@ViewBag.CategoryId" data-pageIndexId="@i" data-priceRange="@ViewBag.Range">@i</a>
                                </li>
                            }
                        
                            }
                            @if (ViewBag.PageIndex < ViewBag.PageCount)
                            {
                                <li class="page-item">
                                <a class="page-link" data-categoryId="@ViewBag.CategoryId" data-pageIndexId="@(ViewBag.PageIndex+1)" data-priceRange="@ViewBag.Range">
                                        <i class="fa-solid fa-angles-right"></i>
                                    </a>
                                </li>
                            }
                        
                    </ul>
                </nav>
            </div>
        </div>
        
        
        
        
    </div>
</div>


<script>


    var lowerSlider = document.querySelector('#lower');
    var upperSlider = document.querySelector('#upper');

    document.querySelector('#two').value = upperSlider.value;
    document.querySelector('#one').value = lowerSlider.value;

    var lowerVal = parseInt(lowerSlider.value);
    var upperVal = parseInt(upperSlider.value);

    upperSlider.oninput = function () {
        lowerVal = parseInt(lowerSlider.value);
        upperVal = parseInt(upperSlider.value);

        if (upperVal < lowerVal + 4) {
            lowerSlider.value = upperVal - 4;
            if (lowerVal == lowerSlider.min) {
                upperSlider.value = 4;
            }
        }
        document.querySelector('#two').value = this.value
    };

    lowerSlider.oninput = function () {
        lowerVal = parseInt(lowerSlider.value);
        upperVal = parseInt(upperSlider.value);
        if (lowerVal > upperVal - 4) {
            upperSlider.value = lowerVal + 4;
            if (upperVal == upperSlider.max) {
                lowerSlider.value = parseInt(upperSlider.max) - 4;
            }
        }
        document.querySelector('#one').value = this.value
    };
</script>
<script>
    $('.rangeFilter').click(function (e) {
        e.preventDefault();

        let val1 = $('#lower').val();
        let val2 = $('#upper').val();
        let val = val1 + "-" + val2
        console.log(val)
        let categoryId = $(this).attr('data-categoryId')
        let pageIndex = $(this).attr('data-pageIndexId')

        fetch('/shop/getshopfilter?range=' + val + '&categoryId=' + categoryId + '&pageIndex=' + pageIndex)
            .then(res => {

                return res.text();
            })
            .then(data => {

                $('.shop-area-section').html(data)
            });

    })



</script>
<script>
    $('.addToBasket').click(function (e) {
        e.preventDefault();
        let productId = $(this).data('id')

        console.log(productId)

        fetch('basket/addbasket?id=' + productId)
            .then(res => {
                return res.text();
            }).then(data => {
                console.log(data)

                $('.minicart-inner-content').html(data);
                fetch('/basket/GetBasketCount')
                    .then(res => {
                        return res.json();
                    }).then(data => {
                        $('.quantity').text(data);
                    });
            })

    })
</script>
<script>
    $('.addToWishList').click(function (e) {
        e.preventDefault();
        let url = $(this).attr('href');
        fetch(url).then(res => {
            return res.text()
        })
            .then(data => {
                $('.wishListTable').html(data);
            })
    })</script>
<script>
    $(".productModal").click(function (e) {
        e.preventDefault();

        let url = $(this).attr('href');
        console.log(url);
        fetch(url).then(res => {
            return res.text();
        })
            .then(data => {
                $('.modal-content').html(data);
                $('.modal-carousel').slick({
                    slidesToShow: 1,
                    arrows: false,
                });
            })

    })
</script>